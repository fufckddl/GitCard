# GitCard ë°°í¬ ê°„ë‹¨ ê°€ì´ë“œ

## ğŸš€ ìë™ ë°°í¬ ì„¤ì • (5ë¶„)

### 0. GitHub ë ˆí¬ì§€í† ë¦¬ì— í”„ë¡œì íŠ¸ ì—…ë¡œë“œ (ë¨¼ì €!)

**âš ï¸ ì¤‘ìš”**: CI/CD ìë™ ë°°í¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë¨¼ì € í”„ë¡œì íŠ¸ë¥¼ GitHubì— ì—…ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤!

**ë¹ ë¥¸ ê°€ì´ë“œ:**
1. GitHubì—ì„œ ìƒˆ ë ˆí¬ì§€í† ë¦¬ ìƒì„±: https://github.com/new
2. ë¡œì»¬ì—ì„œ:
   ```powershell
   cd "C:\Users\dlckd\OneDrive\ë°”íƒ• í™”ë©´\ëª…í•¨"
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/fufckddl/GitCard.git
   git branch -M main
   git push -u origin main
   ```

**ìì„¸í•œ ë‚´ìš©**: `GitHub_ë ˆí¬ì§€í† ë¦¬_ì—…ë¡œë“œ_ê°€ì´ë“œ.md` ì°¸ê³ 

---

### 1. GitHub Secrets ì„¤ì •
**ê²½ë¡œ**: GitHub ì €ì¥ì†Œ â†’ **Settings** â†’ **Security** â†’ **Secrets and variables** â†’ **Actions**

**ë°©ë²•**: "New repository secret" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ 3ê°œë¥¼ ê°ê° ì¶”ê°€:

1. **ì²« ë²ˆì§¸ Secret ì¶”ê°€**
   - Name: `SSH_PRIVATE_KEY`
   - Secret: SSH ê°œì¸ í‚¤ ì „ì²´ ë‚´ìš© (-----BEGIN ë¶€í„° -----END ê¹Œì§€)
   - "Add secret" í´ë¦­

2. **ë‘ ë²ˆì§¸ Secret ì¶”ê°€**
   - "New repository secret" ë‹¤ì‹œ í´ë¦­
   - Name: `SSH_USER`
   - Secret: ì„œë²„ ì‚¬ìš©ìëª… (ì˜ˆ: `ubuntu`)
   - "Add secret" í´ë¦­

3. **ì„¸ ë²ˆì§¸ Secret ì¶”ê°€**
   - "New repository secret" ë‹¤ì‹œ í´ë¦­
   - Name: `SSH_HOST`
   - Secret: ì„œë²„ IP ë˜ëŠ” ë„ë©”ì¸ (ì˜ˆ: `123.45.67.89`)
   - "Add secret" í´ë¦­

âœ… ì™„ë£Œë˜ë©´ 3ê°œì˜ secretsê°€ ëª©ë¡ì— ë³´ì…ë‹ˆë‹¤!

### 2. SSH í‚¤ ì„¤ì •

#### ë°©ë²• A: AWS EC2 PEM í‚¤ ì‚¬ìš© (ê¶Œì¥)
EC2ì—ì„œ ì œê³µë°›ì€ PEM í‚¤ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Windowsì—ì„œ PEM í‚¤ í™•ì¸:**
```powershell
# PowerShellì—ì„œ
Get-Content "C:\Users\dlckd\OneDrive\ë°”íƒ• í™”ë©´\your-key.pem"

# ë˜ëŠ” ë©”ëª¨ì¥ìœ¼ë¡œ ì—´ê¸°
notepad "C:\Users\dlckd\OneDrive\ë°”íƒ• í™”ë©´\your-key.pem"
```

**ì „ì²´ ë‚´ìš© ë³µì‚¬:**
- `-----BEGIN RSA PRIVATE KEY-----` ë¶€í„°
- `-----END RSA PRIVATE KEY-----` ê¹Œì§€
- ì¤„ë°”ê¿ˆ í¬í•¨í•´ì„œ ëª¨ë‘ ë³µì‚¬
- â†’ GitHub Secretsì˜ `SSH_PRIVATE_KEY`ì— ë¶™ì—¬ë„£ê¸°

**ì¤‘ìš”**: EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•˜ì—¬ ê³µê°œ í‚¤ê°€ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸:

**Windows PowerShellì—ì„œ:**

**ë¨¼ì € PEM í‚¤ íŒŒì¼ ê¶Œí•œ ì„¤ì • (í•„ìˆ˜!):**
```powershell
# ì²« ë²ˆì§¸: ìƒì†ëœ ê¶Œí•œ ì œê±°
icacls "C:\Users\dlckd\OneDrive\ë°”íƒ• í™”ë©´\gitcard.pem" /inheritance:r

# ë‘ ë²ˆì§¸: í˜„ì¬ ì‚¬ìš©ìì—ê²Œ ì½ê¸° ê¶Œí•œë§Œ ë¶€ì—¬
icacls "C:\Users\dlckd\OneDrive\ë°”íƒ• í™”ë©´\gitcard.pem" /grant "$($env:USERNAME):R"
```

**ë˜ëŠ” í•œ ì¤„ë¡œ:**
```powershell
icacls "C:\Users\dlckd\OneDrive\ë°”íƒ• í™”ë©´\gitcard.pem" /inheritance:r /grant "$($env:USERNAME):R"
```

**ê·¸ ë‹¤ìŒ EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†:**
```powershell
# ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš© (ê¶Œì¥)
ssh -i "C:\Users\dlckd\OneDrive\ë°”íƒ• í™”ë©´\gitcard.pem" ec2-user@3.37.130.140

# ë˜ëŠ” ìƒëŒ€ ê²½ë¡œ (í˜„ì¬ ìœ„ì¹˜ê°€ C:\Users\dlckdì¼ ë•Œ)
ssh -i "OneDrive\ë°”íƒ• í™”ë©´\gitcard.pem" ec2-user@3.37.130.140
```

**ì ‘ì† í›„ authorized_keys í™•ì¸:**
```bash
cat ~/.ssh/authorized_keys
# PEM í‚¤ì˜ ê³µê°œ í‚¤ê°€ ì—†ìœ¼ë©´ ì¶”ê°€ í•„ìš” (ì¼ë°˜ì ìœ¼ë¡œ EC2ëŠ” ìë™ìœ¼ë¡œ ë“±ë¡ë¨)
```

**ì°¸ê³ **: 
- ê¶Œí•œ ì„¤ì •ì€ í•œ ë²ˆë§Œ í•˜ë©´ ë©ë‹ˆë‹¤
- `ec2-user`ëŠ” Amazon Linux ì‚¬ìš©ìëª… (UbuntuëŠ” `ubuntu`)
- `3.37.130.140`ì€ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ Public IP

#### ë°©ë²• B: ìƒˆë¡œìš´ SSH í‚¤ ìƒì„± (ì„ íƒì‚¬í•­)
```bash
# ë¡œì»¬ì—ì„œ
ssh-keygen -t rsa -b 4096 -f ~/.ssh/github_actions_deploy
# ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ì—”í„° ë‘ ë²ˆ

# ê³µê°œ í‚¤ë¥¼ ì„œë²„ì— ì¶”ê°€
cat ~/.ssh/github_actions_deploy.pub
# â†’ ì„œë²„ì˜ ~/.ssh/authorized_keysì— ë¶™ì—¬ë„£ê¸°

# ê°œì¸ í‚¤ë¥¼ GitHub Secretsì— ì¶”ê°€
cat ~/.ssh/github_actions_deploy
# â†’ SSH_PRIVATE_KEYì— ë¶™ì—¬ë„£ê¸°
```

### 3. ì„œë²„ ì´ˆê¸° ì„¤ì • (í•œ ë²ˆë§Œ)

**EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì† í›„:**

```bash
# /var/www ë””ë ‰í† ë¦¬ í™•ì¸ ë° ìƒì„± (ì—†ìœ¼ë©´ ìƒì„±)
sudo mkdir -p /var/www
cd /var/www

# í”„ë¡œì íŠ¸ í´ë¡ 
sudo git clone https://github.com/fufckddl/gitcard.git
cd gitcard

# ì†Œìœ ê¶Œ ë³€ê²½ (í˜„ì¬ ì‚¬ìš©ìë¡œ)
sudo chown -R $USER:$USER /var/www/gitcard
```

**ì„¤ëª…:**
- `/var/www`ëŠ” ë¦¬ëˆ…ìŠ¤ì˜ í‘œì¤€ ì›¹ ë””ë ‰í† ë¦¬ì…ë‹ˆë‹¤ (ì´ë¯¸ ì¡´ì¬í•  ìˆ˜ ìˆìŒ)
- `mkdir -p`ëŠ” ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±í•˜ê³ , ìˆìœ¼ë©´ ë¬´ì‹œí•©ë‹ˆë‹¤
- `chown`ìœ¼ë¡œ ì†Œìœ ê¶Œì„ ë³€ê²½í•˜ë©´ `sudo` ì—†ì´ ì‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

# í™˜ê²½ ì„¤ì •
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
npm install

# .env íŒŒì¼ ìƒì„± ë° ì„¤ì •
cp env.example .env
nano .env  # í™˜ê²½ ë³€ìˆ˜ ì…ë ¥

# ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
sudo mysql -u root -p
# CREATE DATABASE gitcard;
# CREATE USER 'gitcard_user'@'localhost' IDENTIFIED BY 'password';
# GRANT ALL PRIVILEGES ON gitcard.* TO 'gitcard_user'@'localhost';

# ì´ˆê¸°í™”
python init_db.py
```

### 4. ì„œë¹„ìŠ¤ ì„¤ì •
```bash
# systemd ì„œë¹„ìŠ¤ íŒŒì¼ ìƒì„±
sudo nano /etc/systemd/system/gitcard-api.service
```

íŒŒì¼ ë‚´ìš©:
```ini
[Unit]
Description=GitCard API
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www/gitcard
Environment="PATH=/var/www/gitcard/venv/bin"
ExecStart=/var/www/gitcard/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable gitcard-api
sudo systemctl start gitcard-api
```

### 5. Nginx ì„¤ì •
```bash
sudo nano /etc/nginx/sites-available/gitcard
```

íŒŒì¼ ë‚´ìš©:
```nginx
# API
server {
    listen 80;
    server_name api.yourdomain.com;
    location / {
        proxy_pass http://127.0.0.1:8000;
    }
}

# í”„ë¡ íŠ¸ì—”ë“œ
server {
    listen 80;
    server_name yourdomain.com;
    root /var/www/gitcard/dist;
    index index.html;
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

```bash
sudo ln -s /etc/nginx/sites-available/gitcard /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

---

## âœ… ì™„ë£Œ! ì´ì œ ìë™ ë°°í¬ë¨

### ì‚¬ìš©ë²•
```bash
# ë¡œì»¬ì—ì„œ ì½”ë“œ ìˆ˜ì • í›„
git add .
git commit -m "ì—…ë°ì´íŠ¸"
git push origin main

# â†’ ìë™ìœ¼ë¡œ ì„œë²„ì— ë°°í¬ë¨!
```

### ë°°í¬ í™•ì¸
- GitHub: ì €ì¥ì†Œ â†’ Actions íƒ­
- ì„œë²„ ë¡œê·¸: `sudo journalctl -u gitcard-api -f`
- í—¬ìŠ¤ ì²´í¬: `curl http://localhost:8000/health`

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

**ë°°í¬ ì‹¤íŒ¨?**
```bash
# ì„œë²„ì—ì„œ ìˆ˜ë™ ë°°í¬
cd /var/www/gitcard
git pull origin main
source venv/bin/activate
pip install -r requirements.txt
npm install && npm run build
python init_db.py
sudo systemctl restart gitcard-api
```

**ì„œë¹„ìŠ¤ ì•ˆ ì¼œì§?**
```bash
sudo journalctl -u gitcard-api -n 50  # ë¡œê·¸ í™•ì¸
```

